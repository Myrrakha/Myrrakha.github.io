<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Master - Chinois simplifiÃ©</title>
  <style>
    /* === Style global (conserve l'esthÃ©tique d'origine) === */
    body { background: linear-gradient(135deg, #0f1115, #1c1c24); color: #f0f0f0; font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; }
    .navbar { background: #1a1a24; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
    .nav-title { font-size: 1.2em; font-weight: 600; }
    .nav-right { display: flex; gap: 10px; }
    .center { max-width: 800px; margin: 40px auto; background: #23233a; border-radius: 16px; padding: 28px; box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
    h1 { text-align: center; margin-bottom: 6px; }
    .subtitle { text-align: center; color: #aaa; margin-bottom: 18px; font-size: 1.05em; }
    .action-btn { padding: 10px 18px; border-radius: 10px; background: #3a3a50; border: none; cursor: pointer; color: #f0f0f0; transition: 0.20s; font-size: 0.98em; }
    .action-btn:hover { background: #4e4e6a; }
    .action-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .loading { text-align: center; padding: 28px; font-size: 1.1em; color: #aaa; }

    /* Timers */
    #timers-container { display: flex; gap: 20px; margin-bottom: 18px; align-items: center; }
    #timer-bar-container, #question-timer-bar-container { display: flex; align-items: center; width: 50%; gap: 10px; }
    #timer-bar, #question-timer-bar { width: 100%; height: 10px; background-color: #4e4e6a; border-radius: 6px; overflow: hidden; }
    #timer-fill, #question-timer-fill { height: 100%; width: 0; background-color: #2ecc71; transition: width 0.3s linear; }

    /* Quiz area */
    #quiz-main { display: none; }
    #quiz-section { display:flex; flex-direction:column; gap:14px; align-items:center; }
    .question-box { width:100%; text-align:center; margin-bottom:6px; }
    .question-text { font-size:1.35em; line-height:1.4; margin-bottom:8px; }
    .answers-container { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; width:100%; }
    .answer-btn { padding:12px 14px; border-radius:10px; background:#3a3a50; border:none; cursor:pointer; color:#f0f0f0; font-size:1em; min-width:150px; text-align:center; transition: transform .12s, background .12s; }
    .answer-btn:hover:not(:disabled) { transform: translateY(-3px); background: #4e4e6a; }
    .answer-btn:disabled { opacity:0.85; cursor: default; transform:none; }

    .stats { margin: 12px 0; display:flex; justify-content:space-between; gap:12px; font-size:1.05em; }
    .stats div { flex:1; text-align:center; font-weight:600; }

    #quiz-next-btn, #quiz-restart-btn { display:none; width:100%; margin-top:6px; }

    #quiz-result { display:none; text-align:center; }
    .final-score { font-size:1.8em; color:#2ecc71; margin:12px 0; }

    /* responsive */
    @media (max-width:700px) {
      .answers-container { flex-direction:column; }
      #timers-container { flex-direction:column; }
      #timer-bar-container, #question-timer-bar-container { width:100%; }
    }
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="nav-left"><span class="nav-title">ğŸ¯ Quiz Master - Chinois simplifiÃ©</span></div>
      <div class="nav-right">
        <button class="action-btn" onclick="window.location.href='index.html'">â† Retour</button>
        <button class="action-btn" onclick="window.location.href='settings.html'">RÃ©glages</button>
      </div>
    </nav>
  </header>

  <div class="center">
    <div id="loading" class="loading"><p>Chargement du quizâ€¦</p></div>

    <!-- Timers -->
    <div id="timers-container" style="display:none;">
      <div id="timer-bar-container">
        <span style="white-space:nowrap;">â±ï¸ Temps restant : <strong id="timer">0</strong>s</span>
        <div id="timer-bar"><div id="timer-fill"></div></div>
      </div>
      <div id="question-timer-bar-container">
        <span style="white-space:nowrap;">âš¡ Question : <strong id="question-timer">0</strong>s</span>
        <div id="question-timer-bar"><div id="question-timer-fill"></div></div>
      </div>
    </div>

    <!-- Quiz main -->
    <div id="quiz-main">
      <h1 id="quiz-title">Quiz Chinois</h1>
      <p class="subtitle" id="quiz-subtitle"></p>

      <div id="quiz-section">
        <div class="question-box">
          <div id="quiz-question" class="question-text"></div>
        </div>

        <div class="answers-container" id="quiz-answers"></div>
      </div>

      <div class="stats">
        <div>Score : <span id="quiz-score">0</span></div>
        <div>Vies : <span id="quiz-lives">â¤â¤â¤</span></div>
        <div>Question : <span id="quiz-index">0</span>/<span id="quiz-total">0</span></div>
      </div>

      <button class="action-btn" id="quiz-next-btn">Question suivante</button>
      <button class="action-btn" id="quiz-restart-btn">Recommencer ce niveau</button>
    </div>

    <!-- Result -->
    <div id="quiz-result">
      <h1>ğŸ‰ Quiz terminÃ© !</h1>
      <div class="final-score">Score : <span id="quiz-final-score">0</span></div>
      <p id="result-message" style="font-size:1.05em; margin:8px 0 16px 0;"></p>

      <!-- IMPORTANT : retourne vers index.html (index devrait contenir tes boutons qui ouvrent quiz-chinois.html#level) -->
      <button class="action-btn" onclick="window.location.href='index.html'" style="width:100%; margin-top:8px;">Retour au menu principal</button>
      <button class="action-btn" id="retry-btn" style="width:100%; margin-top:10px;">Recommencer ce niveau</button>
    </div>
  </div>

  <script>
    // === DonnÃ©es complÃ¨tes : 5 niveaux, 10 questions / niveau, 5 options / question ===
    // Chaque opts contient la bonne rÃ©ponse (a) et 4 autres distracteurs.
    const quizData = {
      1: {
        title: "Niveau 1 : Chiffres 1-10",
        subtitle: "Apprenez les chiffres de base en chinois simplifiÃ©",
        questions: [
          { q: "Quel est le caractÃ¨re pour <strong>1</strong> ?", a: "ä¸€", opts: ["ä¸€","äºŒ","ä¸‰","å","äº”"] },
          { q: "Quel est le caractÃ¨re pour <strong>2</strong> ?", a: "äºŒ", opts: ["äºŒ","äº”","å…«","å…­","å››"] },
          { q: "Quel est le caractÃ¨re pour <strong>3</strong> ?", a: "ä¸‰", opts: ["ä¸‰","ä¹","å››","ä¸ƒ","äºŒ"] },
          { q: "Quel est le caractÃ¨re pour <strong>4</strong> ?", a: "å››", opts: ["å››","äº”","å…­","ä¸‰","å"] },
          { q: "Quel est le caractÃ¨re pour <strong>5</strong> ?", a: "äº”", opts: ["äº”","å…«","ä¸€","å","å…­"] },
          { q: "Quel est le caractÃ¨re pour <strong>6</strong> ?", a: "å…­", opts: ["å…­","ä¹","äºŒ","å…«","å››"] },
          { q: "Quel est le caractÃ¨re pour <strong>7</strong> ?", a: "ä¸ƒ", opts: ["ä¸ƒ","ä¸‰","å","å››","å…«"] },
          { q: "Quel est le caractÃ¨re pour <strong>8</strong> ?", a: "å…«", opts: ["å…«","äº”","å…­","ä¹","ä¸€"] },
          { q: "Quel est le caractÃ¨re pour <strong>9</strong> ?", a: "ä¹", opts: ["ä¹","ä¸€","ä¸ƒ","äºŒ","å"] },
          { q: "Quel est le caractÃ¨re pour <strong>10</strong> ?", a: "å", opts: ["å","ä¸‰","å…«","äº”","ä¹"] }
        ]
      },

      2: {
        title: "Niveau 2 : Jours de la semaine",
        subtitle: "MaÃ®trisez les jours de la semaine en chinois",
        questions: [
          { q: "Comment Ã©crit-on <strong>'lundi'</strong> ?", a: "æ˜ŸæœŸä¸€", opts: ["æ˜ŸæœŸä¸€","æ˜ŸæœŸå¤©","æ˜ŸæœŸä¸‰","æ˜ŸæœŸäº”","æ˜ŸæœŸå››"] },
          { q: "Comment Ã©crit-on <strong>'mardi'</strong> ?", a: "æ˜ŸæœŸäºŒ", opts: ["æ˜ŸæœŸäºŒ","æ˜ŸæœŸå››","æ˜ŸæœŸæ—¥","æ˜ŸæœŸå…­","æ˜ŸæœŸä¸‰"] },
          { q: "Comment Ã©crit-on <strong>'mercredi'</strong> ?", a: "æ˜ŸæœŸä¸‰", opts: ["æ˜ŸæœŸä¸‰","æ˜ŸæœŸä¸€","æ˜ŸæœŸäº”","æ˜ŸæœŸå¤©","æ˜ŸæœŸäºŒ"] },
          { q: "Comment Ã©crit-on <strong>'jeudi'</strong> ?", a: "æ˜ŸæœŸå››", opts: ["æ˜ŸæœŸå››","æ˜ŸæœŸäºŒ","æ˜ŸæœŸå…­","æ˜ŸæœŸä¸‰","æ˜ŸæœŸäº”"] },
          { q: "Comment Ã©crit-on <strong>'vendredi'</strong> ?", a: "æ˜ŸæœŸäº”", opts: ["æ˜ŸæœŸäº”","æ˜ŸæœŸæ—¥","æ˜ŸæœŸä¸€","æ˜ŸæœŸå››","æ˜ŸæœŸå…­"] },
          { q: "Comment Ã©crit-on <strong>'samedi'</strong> ?", a: "æ˜ŸæœŸå…­", opts: ["æ˜ŸæœŸå…­","æ˜ŸæœŸä¸‰","æ˜ŸæœŸäº”","æ˜ŸæœŸäºŒ","æ˜ŸæœŸå¤©"] },
          { q: "Comment Ã©crit-on <strong>'dimanche'</strong> ?", a: "æ˜ŸæœŸå¤©", opts: ["æ˜ŸæœŸå¤©","æ˜ŸæœŸæ—¥","æ˜ŸæœŸä¸€","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­"] },
          { q: "Quel jour vient aprÃ¨s æ˜ŸæœŸä¸‰ ?", a: "æ˜ŸæœŸå››", opts: ["æ˜ŸæœŸå››","æ˜ŸæœŸäºŒ","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­","æ˜ŸæœŸå¤©"] },
          { q: "Quel jour vient avant æ˜ŸæœŸå¤© ?", a: "æ˜ŸæœŸå…­", opts: ["æ˜ŸæœŸå…­","æ˜ŸæœŸäº”","æ˜ŸæœŸä¸€","æ˜ŸæœŸæ—¥","æ˜ŸæœŸå››"] },
          { q: "Quel est le premier jour de la semaine ?", a: "æ˜ŸæœŸä¸€", opts: ["æ˜ŸæœŸä¸€","æ˜ŸæœŸå¤©","æ˜ŸæœŸæ—¥","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰"] }
        ]
      },

      3: {
        title: "Niveau 3 : Couleurs de base",
        subtitle: "DÃ©couvrez les couleurs en chinois simplifiÃ©",
        questions: [
          { q: "Comment Ã©crit-on <strong>'rouge'</strong> ?", a: "çº¢è‰²", opts: ["çº¢è‰²","è“è‰²","é»„è‰²","ç™½è‰²","ç»¿è‰²"] },
          { q: "Comment Ã©crit-on <strong>'bleu'</strong> ?", a: "è“è‰²", opts: ["è“è‰²","ç»¿è‰²","é»‘è‰²","çº¢è‰²","ç™½è‰²"] },
          { q: "Comment Ã©crit-on <strong>'jaune'</strong> ?", a: "é»„è‰²", opts: ["é»„è‰²","ç™½è‰²","è“è‰²","é»‘è‰²","çº¢è‰²"] },
          { q: "Comment Ã©crit-on <strong>'vert'</strong> ?", a: "ç»¿è‰²", opts: ["ç»¿è‰²","çº¢è‰²","é»„è‰²","è“è‰²","é»‘è‰²"] },
          { q: "Comment Ã©crit-on <strong>'noir'</strong> ?", a: "é»‘è‰²", opts: ["é»‘è‰²","ç™½è‰²","è“è‰²","çº¢è‰²","ç°è‰²"] },
          { q: "Comment Ã©crit-on <strong>'blanc'</strong> ?", a: "ç™½è‰²", opts: ["ç™½è‰²","é»‘è‰²","é»„è‰²","ç»¿è‰²","è“è‰²"] },
          { q: "Quelle couleur reprÃ©sente çº¢è‰² ?", a: "Rouge", opts: ["Rouge","Bleu","Jaune","Vert","Noir"] },
          { q: "Quelle couleur reprÃ©sente é»‘è‰² ?", a: "Noir", opts: ["Noir","Blanc","Gris","Bleu","Vert"] },
          { q: "Quelle couleur reprÃ©sente ç»¿è‰² ?", a: "Vert", opts: ["Vert","Rouge","Bleu","Jaune","Noir"] },
          { q: "Quelle couleur reprÃ©sente è“è‰² ?", a: "Bleu", opts: ["Bleu","Blanc","Vert","Rouge","Jaune"] }
        ]
      },

      4: {
        title: "Niveau 4 : Membres de la famille",
        subtitle: "Apprenez Ã  dÃ©signer les membres de la famille",
        questions: [
          { q: "Comment Ã©crit-on <strong>'maman'</strong> ?", a: "å¦ˆå¦ˆ", opts: ["å¦ˆå¦ˆ","çˆ¸çˆ¸","å“¥å“¥","å§å§","å¦¹å¦¹"] },
          { q: "Comment Ã©crit-on <strong>'papa'</strong> ?", a: "çˆ¸çˆ¸", opts: ["çˆ¸çˆ¸","å¦ˆå¦ˆ","å¼Ÿå¼Ÿ","å¦¹å¦¹","å“¥å“¥"] },
          { q: "Comment Ã©crit-on <strong>'grand frÃ¨re'</strong> ?", a: "å“¥å“¥", opts: ["å“¥å“¥","å¼Ÿå¼Ÿ","å§å§","å¦¹å¦¹","çˆ¸çˆ¸"] },
          { q: "Comment Ã©crit-on <strong>'petit frÃ¨re'</strong> ?", a: "å¼Ÿå¼Ÿ", opts: ["å¼Ÿå¼Ÿ","å“¥å“¥","çˆ¸çˆ¸","å¦ˆå¦ˆ","å”å”"] },
          { q: "Comment Ã©crit-on <strong>'grande sÅ“ur'</strong> ?", a: "å§å§", opts: ["å§å§","å¦¹å¦¹","å¦ˆå¦ˆ","å“¥å“¥","é˜¿å§¨"] },
          { q: "Comment Ã©crit-on <strong>'petite sÅ“ur'</strong> ?", a: "å¦¹å¦¹", opts: ["å¦¹å¦¹","å§å§","çˆ¸çˆ¸","å¼Ÿå¼Ÿ","å¥¶å¥¶"] },
          { q: "Qui est çˆ¸çˆ¸ ?", a: "Papa", opts: ["Papa","Maman","Grand-pÃ¨re","Oncle","Tante"] },
          { q: "Qui est å§å§ ?", a: "Grande sÅ“ur", opts: ["Grande sÅ“ur","Petite sÅ“ur","Maman","Tante","Soeur cadette"] },
          { q: "Comment dit-on 'grand-mÃ¨re' ?", a: "å¥¶å¥¶", opts: ["å¥¶å¥¶","å¤–å©†","çˆ·çˆ·","å§¥å§¥","çˆ¸çˆ¸"] },
          { q: "Comment dit-on 'oncle' (frÃ¨re du pÃ¨re) ? ", a: "å”å”", opts: ["å”å”","èˆ…èˆ…","ä¼¯ä¼¯","é˜¿å§¨","çˆ·çˆ·"] }
        ]
      },

      5: {
        title: "Niveau 5 : Animaux courants",
        subtitle: "DÃ©couvrez les animaux en chinois simplifiÃ©",
        questions: [
          { q: "Comment Ã©crit-on <strong>'chat'</strong> ?", a: "çŒ«", opts: ["çŒ«","ç‹—","é¸Ÿ","é©¬","ç‰›"] },
          { q: "Comment Ã©crit-on <strong>'chien'</strong> ?", a: "ç‹—", opts: ["ç‹—","çŒ«","é±¼","ç‰›","é©¬"] },
          { q: "Comment Ã©crit-on <strong>'oiseau'</strong> ?", a: "é¸Ÿ", opts: ["é¸Ÿ","é©¬","ç‹—","çŒ«","çŒª"] },
          { q: "Comment Ã©crit-on <strong>'poisson'</strong> ?", a: "é±¼", opts: ["é±¼","ç‰›","çŒ«","ç‹—","é¸Ÿ"] },
          { q: "Comment Ã©crit-on <strong>'cheval'</strong> ?", a: "é©¬", opts: ["é©¬","é¸Ÿ","é±¼","ç‰›","ç¾Š"] },
          { q: "Comment Ã©crit-on <strong>'vache'</strong> ?", a: "ç‰›", opts: ["ç‰›","é©¬","çŒ«","ç‹—","ç¾Š"] },
          { q: "Quel animal reprÃ©sente çŒ« ?", a: "Chat", opts: ["Chat","Chien","Tigre","Lapin","Oiseau"] },
          { q: "Quel animal reprÃ©sente é±¼ ?", a: "Poisson", opts: ["Poisson","Oiseau","Grenouille","Serpent","Chien"] },
          { q: "Quel animal reprÃ©sente é©¬ ?", a: "Cheval", opts: ["Cheval","Vache","Ã‚ne","ZÃ¨bre","ChÃ¨vre"] },
          { q: "Quel animal reprÃ©sente ç‰› ?", a: "Vache", opts: ["Vache","Cheval","Chien","Chat","Mouton"] }
        ]
      }
    };

    // === Variables d'Ã©tat ===
    let currentLevel = null;
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let lives = 3;
    let answered = false;
    let globalTimer = null;
    let questionTimer = null;

    // DOM
    const loadingEl = document.getElementById('loading');
    const timersContainer = document.getElementById('timers-container');
    const quizMain = document.getElementById('quiz-main');
    const quizResult = document.getElementById('quiz-result');
    const quizTitle = document.getElementById('quiz-title');
    const quizSubtitle = document.getElementById('quiz-subtitle');
    const quizQuestion = document.getElementById('quiz-question');
    const quizAnswers = document.getElementById('quiz-answers');
    const quizScore = document.getElementById('quiz-score');
    const quizLives = document.getElementById('quiz-lives');
    const quizIndex = document.getElementById('quiz-index');
    const quizTotal = document.getElementById('quiz-total');
    const quizNextBtn = document.getElementById('quiz-next-btn');
    const quizRestartBtn = document.getElementById('quiz-restart-btn');
    const quizFinalScore = document.getElementById('quiz-final-score');
    const resultMessage = document.getElementById('result-message');
    const retryBtn = document.getElementById('retry-btn');
    const timerDisplay = document.getElementById('timer');
    const questionTimerDisplay = document.getElementById('question-timer');
    const timerFill = document.getElementById('timer-fill');
    const questionTimerFill = document.getElementById('question-timer-fill');

    // === Initialisation ===
    function initQuiz() {
      // read hash
      const hash = window.location.hash.replace('#','');
      const level = parseInt(hash, 10);
      if (!level || !quizData[level]) {
        // si pas de level valide, retourne au menu principal
        window.location.href = 'index.html';
        return;
      }

      currentLevel = level;
      const data = quizData[level];

      // setup
      quizTitle.textContent = data.title;
      quizSubtitle.textContent = data.subtitle;
      questions = [...data.questions].sort(() => Math.random() - 0.5); // shuffle questions
      currentQuestionIndex = 0;
      score = 0;
      lives = 3;
      answered = false;

      // affichage
      loadingEl.style.display = 'none';
      timersContainer.style.display = 'flex';
      quizMain.style.display = 'block';
      quizResult.style.display = 'none';

      updateStats();
      showQuestion();

      startGlobalTimer();
    }

    // === Timers ===
    function startGlobalTimer() {
      clearInterval(globalTimer);
      const totalSeconds = 180; // 3 minutes
      let remaining = totalSeconds;
      timerDisplay.textContent = remaining;
      timerFill.style.width = '0%';

      globalTimer = setInterval(() => {
        if (remaining <= 0) {
          clearInterval(globalTimer);
          endQuiz(true);
          score = correctAnswersCount;
          return;
        }
        timerDisplay.textContent = remaining;
        const percent = (1 - remaining / totalSeconds) * 100;
        timerFill.style.width = percent + '%';
        remaining--;
      }, 1000);
    }

    function startQuestionTimer() {
      clearInterval(questionTimer);
      const qSeconds = 20;
      let remaining = qSeconds;
      questionTimerDisplay.textContent = remaining;
      questionTimerFill.style.width = '0%';

      questionTimer = setInterval(() => {
        if (remaining <= 0) {
          clearInterval(questionTimer);
          // time's up for this question
          handleTimeoutForQuestion();
          return;
        }
        questionTimerDisplay.textContent = remaining;
        questionTimerFill.style.width = (1 - remaining / qSeconds) * 100 + '%';
        remaining--;
      }, 1000);
    }

    function stopQuestionTimer() {
      clearInterval(questionTimer);
      questionTimerFill.style.width = '0%';
    }

    // === Affichage question / rÃ©ponses ===
    function showQuestion() {
      // stop previous timers
      stopQuestionTimer();

      if (currentQuestionIndex >= questions.length || lives <= 0) {
        endQuiz(false);
        score = correctAnswersCount;
        return;
      }

      answered = false;
      quizNextBtn.style.display = 'none';
      quizRestartBtn.style.display = 'none';

      const q = questions[currentQuestionIndex];
      quizQuestion.innerHTML = q.q;

      // build options: shuffle to randomize order
      const shuffled = [...q.opts].sort(() => Math.random() - 0.5);
      quizAnswers.innerHTML = '';
      shuffled.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = opt;
        btn.onclick = () => selectAnswer(opt, q.a, btn);
        quizAnswers.appendChild(btn);
      });

      // update counters
      quizIndex.textContent = currentQuestionIndex + 1;
      quizTotal.textContent = questions.length;

      // start question timer
      startQuestionTimer();
    }

    // === RÃ©ponse sÃ©lectionnÃ©e ===
    function selectAnswer(selected, correct, clickedBtn) {
      if (answered) return;
      answered = true;

      stopQuestionTimer();

      // disable all and colorize
      Array.from(quizAnswers.children).forEach(b => {
        b.disabled = true;
        if (b.textContent === correct) {
          b.style.background = '#2ecc71'; // green
        }
        if (b.textContent === selected && selected !== correct) {
          b.style.background = '#e74c3c'; // red
        }
      });

      if (selected === correct) {
        score++;
      } else {
        lives--;
      }
      updateStats();

      // show next or finish
      if (lives > 0 && currentQuestionIndex < questions.length - 1) {
        quizNextBtn.style.display = 'block';
      } else {
        quizRestartBtn.style.display = 'block';
      }
    }

    // === Timeout pour une question ===
    function handleTimeoutForQuestion() {
      // mark correct answer and reduce life
      Array.from(quizAnswers.children).forEach(b => {
        b.disabled = true;
        // reveal correct
        const q = questions[currentQuestionIndex];
        if (b.textContent === q.a) b.style.background = '#2ecc71';
      });
      lives--;
      updateStats();

      if (lives > 0 && currentQuestionIndex < questions.length - 1) {
        quizNextBtn.style.display = 'block';
      } else {
        quizRestartBtn.style.display = 'block';
      }
    }

    // === Navigation boutons ===
    quizNextBtn.addEventListener('click', () => {
      currentQuestionIndex++;
      showQuestion();
    });

    quizRestartBtn.addEventListener('click', () => {
      // restart same level
      clearInterval(globalTimer);
      clearInterval(questionTimer);
      initQuiz();
    });

    retryBtn.addEventListener('click', () => {
      // restart same level from results
      clearInterval(globalTimer);
      clearInterval(questionTimer);
      initQuiz();
    });

    // === Mise Ã  jour stats ===
    function updateStats() {
      quizScore.textContent = score;
      quizLives.textContent = 'â¤'.repeat(Math.max(0,lives)) + 'â™¡'.repeat(Math.max(0,3-lives));
    }

    // === Fin du quiz ===
    function endQuiz(timeout=false) {
      clearInterval(globalTimer);
      clearInterval(questionTimer);

      quizMain.style.display = 'none';
      quizResult.style.display = 'block';

      // Score final (sur nombre de questions du niveau)
      quizFinalScore.textContent = score + ' / ' + questions.length;

      if (timeout) {
        resultMessage.textContent = 'â³ Temps Ã©coulÃ© ! Essayez encore â€” vous pouvez recommencer le niveau.';
      } else {
        const pct = (questions.length > 0) ? (score / questions.length) * 100 : 0;
        if (pct === 100) resultMessage.textContent = 'ğŸ† Parfait ! Vous maÃ®trisez ce niveau !';
        else if (pct >= 80) resultMessage.textContent = 'ğŸ‘ Excellent travail ! Continuez comme Ã§a !';
        else if (pct >= 60) resultMessage.textContent = 'ğŸ‘ Bon travail ! Encore un peu de pratique !';
        else resultMessage.textContent = 'ğŸ’ª Continuez Ã  pratiquer, vous progressez !';
      }
    }

    // === Hash change listener (changer de niveau depuis index par exemple) ===
    window.addEventListener('hashchange', () => {
      // restart when hash changes
      clearInterval(globalTimer);
      clearInterval(questionTimer);
      initQuiz();
    });

    // === DÃ©marrage initial ===
    // Si la page est chargÃ©e sans hash valide, on renvoie vers index.html
    window.addEventListener('load', () => {
      initQuiz();
    });

  </script>
</body>
</html>
