<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Master - Chinois simplifi√©</title>
  <link rel="stylesheet" href="index.html">
  <style>
    body { background: linear-gradient(135deg, #0f1115, #1c1c24); color: #f0f0f0; font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; }
    .center { max-width: 600px; margin: 60px auto; background: #23233a; border-radius: 16px; padding: 32px; box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
    h1 { text-align: center; }
    .action-btn { margin: 10px; padding: 12px 25px; border-radius: 10px; background: #3a3a50; border: none; cursor: pointer; color: #f0f0f0; transition: 0.25s; }
    .action-btn:hover { background: #4e4e6a; }
    .dropdown { position: relative; display: inline-block; }
    .dropdown-btn { padding: 10px 20px; border-radius: 10px; background: #2e2e3d; color: #f0f0f0; border: none; cursor: pointer; font-weight: 500; transition: 0.25s; }
    .dropdown-content { position: absolute; right: 0; top: 45px; background: #1f1f28; border-radius: 12px; padding: 10px; width: 260px; display: none; flex-direction: column; gap: 8px; border: 1px solid #333; box-shadow: 0 8px 20px rgba(0,0,0,0.4); z-index: 100; }
    .dropdown.open .dropdown-content { display: flex; }
    .dropdown-subtitle { font-size: 0.9em; color: #cfcfcf; margin: 5px 0; }
    .dropdown-item { width: 100%; padding: 10px 15px; border-radius: 8px; border: none; background: #2c2c3a; color: #eaeaea; text-align: left; cursor: pointer; transition: 0.25s; }
    .dropdown-item:hover { background: #3d3d50; }
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="nav-left">
        <span class="nav-title">üéØ Quiz Master</span>
      </div>
      <div class="nav-right">
        <div class="dropdown">
          <button class="dropdown-btn">Quiz ‚ñæ</button>
          <div class="dropdown-content">
            <span class="dropdown-subtitle">üìç Quiz D√©partements</span>
            <button class="dropdown-item" onclick="window.location.href='index.html'">Retour Quiz D√©partements</button>
            <hr style="margin:10px 0; border:0; border-top:1px solid #444;">
            <span class="dropdown-subtitle">üá®üá≥ Quiz Chinois simplifi√©</span>
            <button class="dropdown-item" id="btn-chinois-1">Niveau 1 : Chiffres 1-10</button>
            <button class="dropdown-item" id="btn-chinois-2">Niveau 2 : Jours de la semaine</button>
            <button class="dropdown-item" id="btn-chinois-3">Niveau 3 : Couleurs de base</button>
            <button class="dropdown-item" id="btn-chinois-4">Niveau 4 : Membres famille</button>
            <button class="dropdown-item" id="btn-chinois-5">Niveau 5 : Animaux courants</button>
          </div>
        </div>
        <button class="action-btn" onclick="window.location.href='settings.html'" style="margin-left:10px;">R√©glages</button>
      </div>
    </nav>
  </header>
  <div class="center">
    <h1>Quiz Chinois simplifi√©</h1>
    <div id="quiz-setup">
      <p id="quiz-desc">Choisissez un niveau dans le menu pour commencer !</p>
    </div>
    <div id="quiz-main" style="display:none;">
      <div id="quiz-question" style="font-size:1.5em;margin-bottom:24px;"></div>
      <div id="quiz-answers" style="display:flex;flex-direction:column;gap:14px;"></div>
      <div style="margin:18px 0 0 0;">
        <span>Score : <span id="quiz-score">0</span></span>
        <span style="margin-left:30px;">Vies : <span id="quiz-lives">‚ù§‚ù§‚ù§</span></span>
      </div>
      <button class="action-btn" id="quiz-next-btn" style="display:none;margin-top:24px;">Question suivante</button>
      <button class="action-btn" id="quiz-restart-btn" style="display:none;margin-top:24px;">Recommencer</button>
    </div>
    <div id="quiz-result" style="display:none;text-align:center;margin-top:30px;">
      <h2>Fin du quiz !</h2>
      <div style="font-size:1.2em;margin:18px 0;">Score final : <span id="quiz-final-score">0</span></div>
      <button class="action-btn" onclick="window.location.reload()">Retour au choix du niveau</button>
    </div>
  </div>
  <script>
    // Dropdown JS (m√™me logique que index.html)
    const dropdown = document.querySelector('.dropdown');
    const dropdownBtn = document.querySelector('.dropdown-btn');
    dropdownBtn.addEventListener('click', () => dropdown.classList.toggle('open'));
    document.addEventListener('click', (e) => {
      if (!dropdown.contains(e.target)) dropdown.classList.remove('open');
    });

    // --- Quiz chinois ---
    const quizData = {
      1: {
        desc: "Niveau 1 : Chiffres 1-10",
        questions: [
          { q: "Quel est le caract√®re pour 1 ?", a: "‰∏Ä", opts: ["‰∏Ä", "‰∫å", "‰∏â", "ÂçÅ"] },
          { q: "Quel est le caract√®re pour 2 ?", a: "‰∫å", opts: ["‰∫å", "‰∫î", "ÂÖ´", "ÂÖ≠"] },
          { q: "Quel est le caract√®re pour 3 ?", a: "‰∏â", opts: ["‰∏â", "‰πù", "Âõõ", "‰∏É"] },
          { q: "Quel est le caract√®re pour 4 ?", a: "Âõõ", opts: ["Âõõ", "‰∫î", "ÂÖ≠", "‰∏â"] },
          { q: "Quel est le caract√®re pour 5 ?", a: "‰∫î", opts: ["‰∫î", "ÂÖ´", "‰∏Ä", "ÂçÅ"] },
          { q: "Quel est le caract√®re pour 6 ?", a: "ÂÖ≠", opts: ["ÂÖ≠", "‰πù", "‰∫å", "ÂÖ´"] },
          { q: "Quel est le caract√®re pour 7 ?", a: "‰∏É", opts: ["‰∏É", "‰∏â", "ÂçÅ", "Âõõ"] },
          { q: "Quel est le caract√®re pour 8 ?", a: "ÂÖ´", opts: ["ÂÖ´", "‰∫î", "ÂÖ≠", "‰πù"] },
          { q: "Quel est le caract√®re pour 9 ?", a: "‰πù", opts: ["‰πù", "‰∏Ä", "‰∏É", "‰∫å"] },
          { q: "Quel est le caract√®re pour 10 ?", a: "ÂçÅ", opts: ["ÂçÅ", "‰∏â", "ÂÖ´", "‰∫î"] },
        ]
      },
      2: {
        desc: "Niveau 2 : Jours de la semaine",
        questions: [
          { q: "Comment √©crit-on 'lundi' en chinois simplifi√© ?", a: "ÊòüÊúü‰∏Ä", opts: ["ÊòüÊúü‰∏Ä", "ÊòüÊúüÂ§©", "ÊòüÊúü‰∏â", "ÊòüÊúü‰∫î"] },
          { q: "Comment √©crit-on 'mardi' ?", a: "ÊòüÊúü‰∫å", opts: ["ÊòüÊúü‰∫å", "ÊòüÊúüÂõõ", "ÊòüÊúüÊó•", "ÊòüÊúüÂÖ≠"] },
          { q: "Comment √©crit-on 'mercredi' ?", a: "ÊòüÊúü‰∏â", opts: ["ÊòüÊúü‰∏â", "ÊòüÊúü‰∏Ä", "ÊòüÊúü‰∫î", "ÊòüÊúüÂ§©"] },
          { q: "Comment √©crit-on 'jeudi' ?", a: "ÊòüÊúüÂõõ", opts: ["ÊòüÊúüÂõõ", "ÊòüÊúü‰∫å", "ÊòüÊúüÂÖ≠", "ÊòüÊúü‰∏â"] },
          { q: "Comment √©crit-on 'vendredi' ?", a: "ÊòüÊúü‰∫î", opts: ["ÊòüÊúü‰∫î", "ÊòüÊúüÊó•", "ÊòüÊúü‰∏Ä", "ÊòüÊúüÂõõ"] },
          { q: "Comment √©crit-on 'samedi' ?", a: "ÊòüÊúüÂÖ≠", opts: ["ÊòüÊúüÂÖ≠", "ÊòüÊúü‰∏â", "ÊòüÊúü‰∫î", "ÊòüÊúü‰∫å"] },
          { q: "Comment √©crit-on 'dimanche' ?", a: "ÊòüÊúüÂ§©", opts: ["ÊòüÊúüÂ§©", "ÊòüÊúüÂÖ≠", "ÊòüÊúü‰∏Ä", "ÊòüÊúü‰∫î"] },
        ]
      },
      3: {
        desc: "Niveau 3 : Couleurs de base",
        questions: [
          { q: "Comment √©crit-on 'rouge' ?", a: "Á∫¢Ëâ≤", opts: ["Á∫¢Ëâ≤", "ËìùËâ≤", "ÈªÑËâ≤", "ÁôΩËâ≤"] },
          { q: "Comment √©crit-on 'bleu' ?", a: "ËìùËâ≤", opts: ["ËìùËâ≤", "ÁªøËâ≤", "ÈªëËâ≤", "Á∫¢Ëâ≤"] },
          { q: "Comment √©crit-on 'jaune' ?", a: "ÈªÑËâ≤", opts: ["ÈªÑËâ≤", "ÁôΩËâ≤", "ËìùËâ≤", "ÈªëËâ≤"] },
          { q: "Comment √©crit-on 'vert' ?", a: "ÁªøËâ≤", opts: ["ÁªøËâ≤", "Á∫¢Ëâ≤", "ÈªÑËâ≤", "ËìùËâ≤"] },
          { q: "Comment √©crit-on 'noir' ?", a: "ÈªëËâ≤", opts: ["ÈªëËâ≤", "ÁôΩËâ≤", "ËìùËâ≤", "Á∫¢Ëâ≤"] },
          { q: "Comment √©crit-on 'blanc' ?", a: "ÁôΩËâ≤", opts: ["ÁôΩËâ≤", "ÈªëËâ≤", "ÈªÑËâ≤", "ÁªøËâ≤"] },
        ]
      },
      4: {
        desc: "Niveau 4 : Membres famille",
        questions: [
          { q: "Comment √©crit-on 'maman' ?", a: "Â¶àÂ¶à", opts: ["Â¶àÂ¶à", "Áà∏Áà∏", "Âì•Âì•", "ÂßêÂßê"] },
          { q: "Comment √©crit-on 'papa' ?", a: "Áà∏Áà∏", opts: ["Áà∏Áà∏", "Â¶àÂ¶à", "ÂºüÂºü", "Â¶πÂ¶π"] },
          { q: "Comment √©crit-on 'grand fr√®re' ?", a: "Âì•Âì•", opts: ["Âì•Âì•", "ÂºüÂºü", "ÂßêÂßê", "Â¶πÂ¶π"] },
          { q: "Comment √©crit-on 'petit fr√®re' ?", a: "ÂºüÂºü", opts: ["ÂºüÂºü", "Âì•Âì•", "Áà∏Áà∏", "Â¶àÂ¶à"] },
          { q: "Comment √©crit-on 'grande s≈ìur' ?", a: "ÂßêÂßê", opts: ["ÂßêÂßê", "Â¶πÂ¶π", "Â¶àÂ¶à", "Âì•Âì•"] },
          { q: "Comment √©crit-on 'petite s≈ìur' ?", a: "Â¶πÂ¶π", opts: ["Â¶πÂ¶π", "ÂßêÂßê", "Áà∏Áà∏", "ÂºüÂºü"] },
        ]
      },
      5: {
        desc: "Niveau 5 : Animaux courants",
        questions: [
          { q: "Comment √©crit-on 'chat' ?", a: "Áå´", opts: ["Áå´", "Áãó", "È∏ü", "È©¨"] },
          { q: "Comment √©crit-on 'chien' ?", a: "Áãó", opts: ["Áãó", "Áå´", "È±º", "Áâõ"] },
          { q: "Comment √©crit-on 'oiseau' ?", a: "È∏ü", opts: ["È∏ü", "È©¨", "Áãó", "Áå´"] },
          { q: "Comment √©crit-on 'poisson' ?", a: "È±º", opts: ["È±º", "Áâõ", "Áå´", "Áãó"] },
          { q: "Comment √©crit-on 'cheval' ?", a: "È©¨", opts: ["È©¨", "È∏ü", "È±º", "Áâõ"] },
          { q: "Comment √©crit-on 'vache' ?", a: "Áâõ", opts: ["Áâõ", "È©¨", "Áå´", "Áãó"] },
        ]
      }
    };

    let quizLevel = null;
    let quizQuestions = [];
    let quizCurrent = 0;
    let quizScore = 0;
    let quizLives = 3;
    let quizAnswered = false;

    const quizSetup = document.getElementById('quiz-setup');
    const quizMain = document.getElementById('quiz-main');
    const quizQuestion = document.getElementById('quiz-question');
    const quizAnswers = document.getElementById('quiz-answers');
    const quizScoreSpan = document.getElementById('quiz-score');
    const quizLivesSpan = document.getElementById('quiz-lives');
    const quizNextBtn = document.getElementById('quiz-next-btn');
    const quizRestartBtn = document.getElementById('quiz-restart-btn');
    const quizResult = document.getElementById('quiz-result');
    const quizFinalScore = document.getElementById('quiz-final-score');
    const quizDesc = document.getElementById('quiz-desc');

    function startQuiz(level) {
      quizLevel = level;
      quizQuestions = [...quizData[level].questions].sort(() => Math.random() - 0.5);
      quizCurrent = 0;
      quizScore = 0;
      quizLives = 3;
      quizAnswered = false;
      quizSetup.style.display = 'none';
      quizResult.style.display = 'none';
      quizMain.style.display = '';
      quizScoreSpan.textContent = quizScore;
      quizLivesSpan.textContent = '‚ù§‚ù§‚ù§';
      quizRestartBtn.style.display = 'none';
      showQuestion();
    }

    function showQuestion() {
      quizAnswered = false;
      quizNextBtn.style.display = 'none';
      quizRestartBtn.style.display = 'none';
      if (quizCurrent >= quizQuestions.length || quizLives <= 0) {
        endQuiz();
        return;
      }
      const q = quizQuestions[quizCurrent];
      quizQuestion.innerHTML = q.q;
      quizAnswers.innerHTML = '';
      const opts = [...q.opts].sort(() => Math.random() - 0.5);
      opts.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'action-btn';
        btn.textContent = opt;
        btn.onclick = () => selectAnswer(opt, q.a, btn);
        quizAnswers.appendChild(btn);
      });
    }

    function selectAnswer(selected, correct, btn) {
      if (quizAnswered) return;
      quizAnswered = true;
      Array.from(quizAnswers.children).forEach(b => {
        b.disabled = true;
        if (b.textContent === correct) b.style.background = '#2ecc71';
        if (b.textContent === selected && selected !== correct) b.style.background = '#e74c3c';
      });
      if (selected === correct) {
        quizScore++;
        quizScoreSpan.textContent = quizScore;
      } else {
        quizLives--;
        quizLivesSpan.textContent = '‚ù§'.repeat(quizLives) + '‚ô°'.repeat(3 - quizLives);
      }
      if (quizLives > 0 && quizCurrent < quizQuestions.length - 1) {
        quizNextBtn.style.display = '';
      } else {
        quizRestartBtn.style.display = '';
      }
    }

    quizNextBtn.onclick = () => {
      quizCurrent++;
      showQuestion();
    };
    quizRestartBtn.onclick = () => startQuiz(quizLevel);

    function endQuiz() {
      quizMain.style.display = 'none';
      quizResult.style.display = '';
      quizFinalScore.textContent = quizScore;
    }

    // D√©marrage auto selon l'ancre (niveau)
    // --- D√©blocage des niveaux selon score global ---
    // Pour la d√©mo, on prend le score global depuis localStorage (cl√© 'globalScore'), sinon 0
    const requiredChineseUnlock = { 1: 200, 2: 230, 3: 260, 4: 350, 5: 400 };
    function getGlobalScore() {
      // Essayons de lire le score global du localStorage (sauvegard√© par settings ou index)
      let score = 0;
      try {
        score = parseInt(localStorage.getItem('globalScore') || '0', 10);
      } catch(e) {}
      return isNaN(score) ? 0 : score;
    }

    function updateChineseButtons() {
      const globalScore = getGlobalScore();
      for (let i = 1; i <= 5; i++) {
        const btn = document.getElementById('btn-chinois-' + i);
        if (!btn) continue;
        if (globalScore < requiredChineseUnlock[i]) {
          btn.classList.add('dropdown-item-disabled');
          btn.disabled = true;
          btn.textContent = `Niveau ${i} (üîí ${requiredChineseUnlock[i]} pts)`;
        } else {
          btn.classList.remove('dropdown-item-disabled');
          btn.disabled = false;
          // Remettre le texte normal
          if (i === 1) btn.textContent = 'Niveau 1 : Chiffres 1-10';
          if (i === 2) btn.textContent = 'Niveau 2 : Jours de la semaine';
          if (i === 3) btn.textContent = 'Niveau 3 : Couleurs de base';
          if (i === 4) btn.textContent = 'Niveau 4 : Membres famille';
          if (i === 5) btn.textContent = 'Niveau 5 : Animaux courants';
        }
      }
    }

    // Ajout listeners pour chaque bouton
    for (let i = 1; i <= 5; i++) {
      const btn = document.getElementById('btn-chinois-' + i);
      if (!btn) continue;
      btn.onclick = function(e) {
        updateChineseButtons(); // Toujours mettre √† jour l'√©tat visuel
        if (btn.disabled || btn.classList.contains('dropdown-item-disabled')) {
          e.preventDefault();
          alert(`Vous devez avoir ${requiredChineseUnlock[i]} points globaux pour d√©bloquer ce niveau !`);
          return false;
        }
        window.location.hash = '#' + i;
        dropdown.classList.remove('open');
      };
    }

    // Style pour les boutons d√©sactiv√©s
    const style = document.createElement('style');
    style.innerHTML = `.dropdown-item-disabled { opacity: 0.5 !important; cursor: not-allowed !important; }`;
    document.head.appendChild(style);

    // V√©rifie le hash et le score √† chaque affichage
    function checkHash() {
      updateChineseButtons();
      const h = window.location.hash.replace('#','');
      if (quizData[h]) {
        if (getGlobalScore() < requiredChineseUnlock[h]) {
          quizDesc.textContent = `Niveau ${h} verrouill√© : ${requiredChineseUnlock[h]} points globaux requis.`;
          quizSetup.style.display = '';
          quizMain.style.display = 'none';
          quizResult.style.display = 'none';
          // R√©initialise le hash si niveau non d√©bloqu√©
          window.location.hash = '';
          return;
        }
        quizDesc.textContent = quizData[h].desc;
        setTimeout(() => startQuiz(h), 500);
      }
    }
    window.addEventListener('hashchange', checkHash);
    // Toujours mettre √† jour l'√©tat visuel au chargement
    updateChineseButtons();
    checkHash();
  </script>
</body>
</html>
