<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz Master - Population</title>
<style>
  body { background: linear-gradient(135deg,#0f1115,#1c1c24); color:#f0f0f0; font-family:'Segoe UI',Roboto,sans-serif; margin:0; }
  .navbar { max-width:1100px; margin:auto; display:flex; justify-content:flex-start; align-items:center; padding:12px 20px; }
  .nav-title { font-size:1.4em; font-weight:600; color:#eaeaea; margin-right:30px; }
  .nav-tab { padding:10px 22px; border-radius:10px 10px 0 0; background:#2e2e3d; color:#f0f0f0; border:none; cursor:pointer; font-weight:500; transition:0.25s; margin-right:8px; }
  .nav-tab.active, .nav-tab:hover { background:#45455a; color:#fff; }

  /* Encadr√© central */
  .center-box {
    max-width:900px; margin:40px auto; background:#23233a;
    padding:30px; border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.4);
  }

  /* Onglets internes */
  .tab-bar {
    display:flex; margin-bottom:20px;
  }
  .subtab {
    padding:10px 20px; background:#2e2e3d; margin-right:8px; border-radius:8px;
    cursor:pointer; transition:0.2s; border:none; color:#eaeaea;
  }
  .subtab.active, .subtab:hover {
    background:#45455a;
  }

  /* Tableau habitants */
  table {
    width:100%; border-collapse:collapse; margin-top:20px;
  }
  th, td {
    padding:12px; border-bottom:1px solid #3a3a50; text-align:left;
  }
  th { cursor:pointer; background:#2e2e3d; }
  tr:hover { background:#34344d; cursor:pointer; }

  /* Popup modal */
  .modal-bg {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center;
  }
  .modal {
    background:#2e2e3d; padding:25px; border-radius:12px; width:380px;
    box-shadow:0 8px 32px rgba(0,0,0,0.5);
  }
  .modal input, .modal select {
    width:100%; padding:10px; margin:8px 0; border-radius:6px; border:none;
    background:#1c1c28; color:#eee;
  }
  .action-btn {
    padding:12px 25px; background:#3a3a50; border:none; border-radius:10px;
    cursor:pointer; color:#f0f0f0; margin-top:15px; width:100%; transition:0.25s;
  }
  .action-btn:hover { background:#4e4e6a; }
</style>
</head>

<body>
<header>
  <nav class="navbar">
    <span class="nav-title">üéØ Quiz Master</span>
    <button class="nav-tab" onclick="window.location.href='index.html'">Quiz</button>
    <button class="nav-tab" onclick="window.location.href='base.html'">Base</button>
    <button class="nav-tab active">Population</button>
  </nav>
</header>

<div class="center-box">

  <button class="action-btn" onclick="window.location.href='base.html'">‚¨Ö Retour √† la base</button>

  <!-- Onglets internes -->
  <div class="tab-bar">
    <button class="subtab active" id="tab-general">G√©n√©ral</button>
    <button class="subtab" id="tab-liste">Liste des habitants</button>
  </div>

  <!-- Contenu dynamique -->
  <div id="content-area"></div>
</div>

<!-- MODAL ‚ö†Ô∏è -->
<div class="modal-bg" id="modal-bg">
  <div class="modal" id="modal">
    <h3 id="modal-name"></h3>
    <label>M√©tier :</label>
    <select id="edit-job">
      <option>Paysan</option>
      <option>Serf</option>
      <option>Citoyen</option>
      <option>Noble</option>
      <option>Artisan</option>
      <option>Soldat</option>
    </select>

    <label>Revenus :</label>
    <input type="number" id="edit-income">

    <label>Bonheur (0-100) :</label>
    <input type="number" id="edit-happiness" min="0" max="100">

    <label>Confort (0-100) :</label>
    <input type="number" id="edit-comfort" min="0" max="100">

    <button class="action-btn" id="btn-save">Enregistrer</button>
  </div>
</div>

<script>
/* --- Donn√©es population (stock√©es) --- */
function loadPopulation() {
  let pop = JSON.parse(localStorage.getItem("playerPopulation") || "[]");
  if (pop.length === 0) {
    // G√©n√©ration de test si vide
    pop = [
      { id:1, name:"Adrien", job:"Paysan", income:2, happiness:70, comfort:40 },
      { id:2, name:"Mila", job:"Serf", income:1, happiness:55, comfort:30 },
      { id:3, name:"Lucien", job:"Citoyen", income:5, happiness:80, comfort:65 },
      { id:4, name:"S√©ra", job:"Noble", income:12, happiness:90, comfort:95 }
    ];
    localStorage.setItem("playerPopulation", JSON.stringify(pop));
  }
  return pop;
}
function savePopulation(pop) {
  localStorage.setItem("playerPopulation", JSON.stringify(pop));
}

/* --- Onglet G√©n√©ral --- */
function displayGeneral() {
  const pop = loadPopulation();
  const total = pop.length;

  const classes = {};
  pop.forEach(p => { classes[p.job] = (classes[p.job]||0)+1; });

  const avgHappiness = Math.round(pop.reduce((a,p)=>a+p.happiness,0) / total);

  let html = `
    <h2>Population g√©n√©rale</h2>
    <p><strong>Total :</strong> ${total}</p>

    <h3>Par classe sociale :</h3>
    <ul>
  `;
  for (let c in classes) {
    html += `<li>${c} : ${classes[c]}</li>`;
  }
  html += `
    </ul>

    <h3>Bonheur moyen :</h3>
    <p>${avgHappiness} / 100</p>
  `;

  document.getElementById("content-area").innerHTML = html;
}

/* --- Onglet Liste --- */
let currentSort = { column:null, asc:true };

function displayListe() {
  let pop = loadPopulation();

  // Tri
  if (currentSort.column) {
    pop.sort((a,b)=>{
      if (a[currentSort.column] < b[currentSort.column]) return currentSort.asc?-1:1;
      if (a[currentSort.column] > b[currentSort.column]) return currentSort.asc?1:-1;
      return 0;
    });
  }

  let html = `
    <h2>Liste compl√®te des habitants</h2>
    <table>
      <thead>
        <tr>
          <th onclick="sortBy('name')">Nom</th>
          <th onclick="sortBy('job')">M√©tier</th>
          <th onclick="sortBy('income')">Revenus</th>
          <th onclick="sortBy('happiness')">Bonheur</th>
          <th onclick="sortBy('comfort')">Confort</th>
        </tr>
      </thead>
      <tbody>
  `;

  pop.forEach(p=>{
    html += `
      <tr onclick="openModal(${p.id})">
        <td>${p.name}</td>
        <td>${p.job}</td>
        <td>${p.income}</td>
        <td>${p.happiness}</td>
        <td>${p.comfort}</td>
      </tr>`;
  });

  html += `</tbody></table>`;

  document.getElementById("content-area").innerHTML = html;
}

function sortBy(col) {
  if (currentSort.column === col) currentSort.asc = !currentSort.asc;
  else { currentSort.column = col; currentSort.asc = true; }
  displayListe();
}

/* --- Modal gestion habitant --- */
function openModal(id) {
  const pop = loadPopulation();
  const person = pop.find(p=>p.id===id);

  document.getElementById("modal-bg").style.display = "flex";
  document.getElementById("modal-name").textContent = person.name;

  document.getElementById("edit-job").value = person.job;
  document.getElementById("edit-income").value = person.income;
  document.getElementById("edit-happiness").value = person.happiness;
  document.getElementById("edit-comfort").value = person.comfort;

  document.getElementById("btn-save").onclick = () => {
    person.job = document.getElementById("edit-job").value;
    person.income = Number(document.getElementById("edit-income").value);
    person.happiness = Number(document.getElementById("edit-happiness").value);
    person.comfort = Number(document.getElementById("edit-comfort").value);
    savePopulation(pop);
    document.getElementById("modal-bg").style.display="none";
    displayListe();
  };
}

document.getElementById("modal-bg").onclick = e=>{
  if (e.target.id==="modal-bg") e.target.style.display="none";
};

/* --- Gestion onglets --- */
document.getElementById("tab-general").onclick = ()=>{
  document.getElementById("tab-general").classList.add("active");
  document.getElementById("tab-liste").classList.remove("active");
  displayGeneral();
};

document.getElementById("tab-liste").onclick = ()=>{
  document.getElementById("tab-general").classList.remove("active");
  document.getElementById("tab-liste").classList.add("active");
  displayListe();
};

/* Affichage par d√©faut */
displayGeneral();
</script>

</body>
</html>
