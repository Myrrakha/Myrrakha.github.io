<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- SEO de la page d'accueil -->
    <title>Quiz Master - Accueil</title>
    <meta name="description"
        content="Testez vos connaissances avec notre quiz des d√©partements fran√ßais. 5 niveaux de difficult√©, corrections instantan√©es et progression suivie.">
    <meta name="keywords"
        content="quiz, d√©partements, france, g√©ographie, jeu, apprendre les d√©partements, quiz france, test g√©ographie">
    <link rel="canonical" href="https://myrrakha.github.io/index.html">
    <!-- OpenGraph pour r√©seaux sociaux -->
    <meta property="og:title" content="Quiz des D√©partements Fran√ßais">
    <meta property="og:description" content="Saurez-vous reconna√Ætre les 101 d√©partements ? 5 niveaux de difficult√©.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://myrrakha.github.io/index.html">
    <meta property="og:image" content="https://myrrakha.github.io/images/logo.jpg">
    <!-- Twitter card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Quiz des D√©partements Fran√ßais">
    <meta name="twitter:description"
        content="Mettez votre connaissance de la France √† l'√©preuve avec nos quiz niveaux 1 √† 5.">
    <meta name="twitter:image" content="https://myrrakha.github.io/images/preview.jpg">
    <!-- FAVICONS -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="apple-touch-icon" sizes="1024x1024" href="/apple-touch-icon-1024x1024.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/favicon-64x64.png">
    <link rel="icon" type="image/png" sizes="128x128" href="/favicon-128x128.png">
    <link rel="icon" type="image/png" sizes="256x256" href="/favicon-256x256.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <style>
        :root {
            --bg-dark: #0b0f14;
            --panel-dark: rgba(12,16,22,0.6);
            --glass-bg: rgba(255,255,255,0.03);
            --glass-border: rgba(255,255,255,0.06);
            --violet-main: #7f63cc;
            --violet-dark: #5b3bbd;
            --radius: 14px;
            --spacing-unit: 0.8em;
        }
        
        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            padding: var(--spacing-unit);
            background: var(--bg-dark);
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            color: #d7e6f2;
            line-height: 1.5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            background: var(--glass-bg);
            backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        
        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--violet-main);
            margin-bottom: 1.5rem;
        }
        
        .auth-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 8px;
            color: #aaa;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .auth-tab.active {
            background: var(--violet-main);
            color: white;
        }
        
        .form-group {
            margin-bottom: 1rem;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9em;
            color: #aaa;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 1rem;
        }
        
        .auth-btn {
            background: var(--violet-main);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-top: 0.5rem;
        }
        
        .auth-btn:hover {
            background: var(--violet-dark);
        }
        
        .error-message {
            color: #ff6b6b;
            margin: 0.5rem 0;
            font-size: 0.9em;
            min-height: 1.5rem;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--violet-main);
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üéØ Quiz Master</div>
        
        <div class="auth-tabs">
            <button class="auth-tab active" data-tab="login">üîë Connexion</button>
            <button class="auth-tab" data-tab="register">üìù Inscription</button>
        </div>
        
        <div id="login-form">
            <div class="form-group">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" placeholder="votre@email.com" required>
            </div>
            <div class="form-group">
                <label for="login-password">Mot de passe</label>
                <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="8">
            </div>
            <div class="error-message" id="login-error"></div>
            <button class="auth-btn" id="login-submit">Se connecter</button>
        </div>
        
        <div id="register-form" class="hidden">
            <div class="form-group">
                <label for="register-username">Username</label>
                <input type="text" id="register-username" placeholder="votre_nom d'utilisateur" required minlength="3" maxlength="20">
            </div>
            <div class="form-group">
                <label for="register-email">Email</label>
                <input type="email" id="register-email" placeholder="votre@email.com" required>
            </div>
            <div class="form-group">
                <label for="register-password">Mot de passe</label>
                <input type="password" id="register-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="8">
            </div>
            <div class="error-message" id="register-error"></div>
            <button class="auth-btn" id="register-submit">S'inscrire</button>
        </div>
        
        <div id="loading" class="hidden">
            <div class="loading"></div>
            <p>Chargement...</p>
        </div>
    </div>

    <script>
        // Configuration API
        const API_BASE_URL = 'https://vps-ef56fd92.vps.ovh.net/api';
        
        // V√©rifier si l'utilisateur est d√©j√† connect√©
        document.addEventListener('DOMContentLoaded', async () => {
            if (await checkAuth()) {
                window.location.href = 'accueil.html';
            }
        });
        
        // Basculer entre les onglets
        document.querySelectorAll('.auth-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.add('hidden');
                
                if (tab.dataset.tab === 'login') {
                    document.getElementById('login-form').classList.remove('hidden');
                } else {
                    document.getElementById('register-form').classList.remove('hidden');
                }
                
                // R√©initialiser les messages d'erreur
                document.getElementById('login-error').textContent = '';
                document.getElementById('register-error').textContent = '';
            });
        });
        
        // Soumission du formulaire de connexion
        document.getElementById('login-submit').addEventListener('click', async () => {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error');
            
            if (!email || !password) {
                errorEl.textContent = 'Veuillez remplir tous les champs';
                return;
            }
            
            showLoading(true);
            errorEl.textContent = '';
            
            try {
                console.log(`üöÄ Tentative de connexion vers: ${API_BASE_URL}/auth/login`);
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Erreur de connexion');
                }
                
                // Stocker le token JWT
                localStorage.setItem('quiz_token', data.token);
                localStorage.setItem('quiz_username, data.user.username');
                
                // Redirection vers la page d'accueil
                window.location.href = 'accueil.html';
                
            } catch (error) {
                errorEl.textContent = error.message || 'Erreur de connexion';
                console.error('‚ùå Erreur lors de la connexion (FETCH):', error);
            } finally {
                showLoading(false);
            }
        });
        
        // Soumission du formulaire d'inscription
        document.getElementById('register-submit').addEventListener('click', async () => {
            const username = document.getElementById('register-username').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const errorEl = document.getElementById('register-error');
            
            if (!username || !email || !password) {
                errorEl.textContent = 'Veuillez remplir tous les champs';
                return;
            }
            
            if (username.length < 3) {
                errorEl.textContent = "Le nom d'utilisateur doit contenir au moins 3 caract√®res.";
                return;
            }
            
            if (password.length < 8) {
                errorEl.textContent = 'Le mot de passe doit contenir au moins 8 caract√®res';
                return;
            }
            
            showLoading(true);
            errorEl.textContent = '';
            
            try {
                console.log(`üöÄ Tentative d'inscription vers: ${API_BASE_URL}/auth/register`);

                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ username, email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Erreur lors de l\'inscription');
                }
                
                // Connexion automatique apr√®s inscription
                localStorage.setItem('quiz_token', data.token);
                localStorage.setItem('quiz_username', data.user.username);
                
                // Redirection vers la page d'accueil
                window.location.href = 'accueil.html';
                
            } catch (error) {
                errorEl.textContent = error.message || 'Erreur lors de l\'inscription';
                console.error('‚ùå Erreur lors de l\'inscription (FETCH):', error);
            } finally {
                showLoading(false);
            }
        });
        
        // V√©rifier si l'utilisateur est d√©j√† authentifi√©
        async function checkAuth() {
            const token = localStorage.getItem('quiz_token');
            if (!token) return false;
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json'
                    }
                });
                
                return response.ok;
            } catch (error) {
                console.error('Erreur lors de la v√©rification de la session:', error);
                return false;
            }
        }
        
        // Afficher/masquer l'indicateur de chargement
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
            document.getElementById('login-submit').disabled = show;
            document.getElementById('register-submit').disabled = show;
        }
    </script>
</body>
</html>