<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz D√©partements</title>
<style>
/* ====================== GENERAL ====================== */
.hidden {
    display: none !important;
}

body {
    margin: 0;
    font-family: 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #0f1115, #1c1c24);
    color: #f0f0f0;
}

/* ====================== HOVER WARNING ====================== */
#hover-warning {
    position: absolute;
    padding: 8px 14px;
    background: rgba(0, 0, 0, 0.85);
    color: white;
    font-size: 14px;
    border-radius: 6px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 9999;
}

/* ====================== HEADER ====================== */
header {
    width: 100%;
    background: rgba(20, 20, 28, 0.8);
    backdrop-filter: blur(8px);
    border-bottom: 1px solid #333;
    position: sticky;
    top: 0;
    z-index: 1000;
}

.navbar {
    max-width: 1100px;
    margin: auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
}

.nav-left .nav-title {
    font-size: 1.4em;
    font-weight: 600;
    color: #eaeaea;
    letter-spacing: 1px;
}

/* ====================== DROPDOWN ====================== */
.dropdown {
    position: relative;
}

.dropdown-btn {
    padding: 10px 20px;
    border-radius: 10px;
    background: #2e2e3d;
    color: #f0f0f0;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: 0.25s;
}

.dropdown-btn:hover {
    background: #45455a;
}

.dropdown-content {
    position: absolute;
    right: 0;
    top: 45px;
    background: #1f1f28;
    border-radius: 12px;
    padding: 10px;
    width: 260px;
    display: none;
    flex-direction: column;
    gap: 8px;
    border: 1px solid #333;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    z-index: 100;
}

.dropdown.open .dropdown-content {
    display: flex;
}

.dropdown-subtitle {
    font-size: 0.9em;
    color: #cfcfcf;
    margin: 5px 0;
}

.dropdown-item {
    width: 100%;
    padding: 10px 15px;
    border-radius: 8px;
    border: none;
    background: #2c2c3a;
    color: #eaeaea;
    text-align: left;
    cursor: pointer;
    transition: 0.25s;
}

.dropdown-item:hover {
    background: #3d3d50;
}

.dropdown-item.disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* ====================== ACCUEIL ====================== */
#home-section {
    padding: 80px 20px;
    text-align: center;
}

.home-center h2 {
    font-size: 2.2em;
    margin-bottom: 10px;
}

.home-center p {
    font-size: 1.2em;
    opacity: 0.8;
}

/* ====================== QUIZ ====================== */
#quiz-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 40px;
}

.quiz-container {
    display: flex;
    gap: 35px;
    width: 90%;
    max-width: 1000px;
    justify-content: center;
}

.question-box {
    flex: 2;
    background: #262633;
    padding: 30px;
    border-radius: 15px;
    font-size: 1.8em;
    font-weight: 600;
    min-height: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    box-shadow: 0 0 20px rgba(0,0,0,0.35);
}

.answers-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.answer-btn {
    padding: 15px;
    font-size: 1.2em;
    border-radius: 12px;
    background: #323248;
    color: #f0f0f0;
    cursor: pointer;
    border: none;
    transition: 0.18s;
}

.answer-btn:hover:not(:disabled) {
    transform: scale(1.04);
    background: #4a4a65;
}

.answer-btn:disabled {
    cursor: not-allowed;
}

.correct {
    background-color: #2ecc71 !important;
}

.incorrect {
    background-color: #e74c3c !important;
}

/* ====================== TIMERS & VIES ====================== */
#timers-container {
    width: 92%;
    max-width: 1000px;
    margin-top: 25px;
}

#timer-bar-container, 
#question-timer-bar-container {
    margin: 10px 0;
    text-align: left;
    font-size: 0.95em;
}

#timer-bar, 
#question-timer-bar {
    width: 100%;
    height: 28px;
    background: #2b2b3a;
    border-radius: 10px;
    margin-top: 6px;
    overflow: hidden;
}

#timer-fill, 
#question-timer-fill {
    height: 100%;
    width: 100%;
    border-radius: 10px;
    transition: width 0.15s linear;
}

#timer-fill { background: #9c28a7ff; }
#question-timer-fill { background: #a832d6; }

#score-lives {
    margin-top: 20px;
    display: flex;
    gap: 80px;
    justify-content: center;
    font-size: 1.3em;
}

#lives {
    color: #ff4b4b;
    font-size: 1.4em;
}

/* ====================== RESULTAT ====================== */
#result-section {
    margin-top: 60px;
    text-align: center;
}

.action-btn {
    margin: 10px;
    padding: 12px 25px;
    border-radius: 10px;
    background: #3a3a50;
    border: none;
    cursor: pointer;
    color: #f0f0f0;
    transition: 0.25s;
}

.action-btn:hover {
    background: #4e4e6a;
}

/* ====================== RESPONSIVE ====================== */
@media screen and (max-width: 750px) {
    .quiz-container {
        flex-direction: column;
    }
    .question-box {
        font-size: 1.8em;
    }
    #score-lives {
        flex-direction: column;
        gap: 15px;
    }
    .dropdown-content {
        width: 200px;
        right: -20px;
    }
}
</style>
</head>
<body>

<header>
    <nav class="navbar">
        <div class="nav-left">
            <span class="nav-title">Quiz Master</span>
        </div>

        <div class="nav-right">
            <div class="dropdown">
                <button class="dropdown-btn">Quiz ‚ñæ</button>
                <div class="dropdown-content">
                    <div class="dropdown-subgroup">
                        <span class="dropdown-subtitle">üìç Quiz D√©partements</span>
                        <button class="dropdown-item" data-mode="1">Mode 1 : Nom ‚Üí Num√©ro</button>
                        <button class="dropdown-item" data-mode="2">Mode 2 : Num√©ro ‚Üí Nom</button>
                        <button class="dropdown-item" data-mode="3">Mode 3 : Forme ‚Üí Nom/Num√©ro</button>
                        <button class="dropdown-item" data-mode="4">Mode 4 : Pr√©fecture ‚Üí D√©partement</button>
                        <button class="dropdown-item" data-mode="5">Mode 5 : Mix Nom/Num/Pr√©f</button>
                        <button class="dropdown-item" data-mode="6">Mode 6 : Mix Total</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>

<main>
    <!-- SECTION ACCUEIL -->
    <section id="home-section">
        <div class="home-center">
            <h2>Bienvenue üëã</h2>
            <p>S√©lectionne un quiz dans le menu ci-dessus pour commencer.</p>
        </div>
    </section>

    <!-- SECTION QUIZ -->
    <section id="quiz-section" class="hidden">
        <div class="quiz-container">
            <div class="question-box">
                <div id="question"></div>
            </div>

            <div class="answers-container">
                <button class="answer-btn"></button>
                <button class="answer-btn"></button>
                <button class="answer-btn"></button>
                <button class="answer-btn"></button>
                <button class="answer-btn"></button>
            </div>
        </div>

        <!-- TIMERS -->
        <div id="timers-container">
            <div id="timer-bar-container">
                <span>‚è±Ô∏è Temps restant : <span id="timer">0</span>s</span>
                <div id="timer-bar">
                    <div id="timer-fill"></div>
                </div>
            </div>
            <div id="question-timer-bar-container">
                <span>‚ö° Question : <span id="question-timer">0</span>s</span>
                <div id="question-timer-bar">
                    <div id="question-timer-fill"></div>
                </div>
            </div>
        </div>

        <!-- SCORE & VIES -->
        <div id="score-lives">
            <div>Score : <span id="score">0</span></div>
            <div id="lives">‚ù§‚ù§‚ù§‚ù§‚ù§</div>
        </div>
    </section>

    <!-- SECTION R√âSULTAT -->
    <section id="result-section" class="hidden">
        <h2>Fin de la partie üéâ</h2>
        <p>Score final : <span id="final-score">0</span></p>
        <button id="restart-btn" class="action-btn">Rejouer</button>
        <button id="home-btn" class="action-btn">Retour √† l'accueil</button>
    </section>
</main>

<!-- Hover Warning -->
<div id="hover-warning"></div>

<script>
const departements = [
    { nom: "Ain", numero: "01", prefecture: "Bourg-en-Bresse" },
    { nom: "Aisne", numero: "02", prefecture: "Laon" },
    { nom: "Allier", numero: "03", prefecture: "Moulins" },
    { nom: "Alpes-de-Haute-Provence", numero: "04", prefecture: "Digne-les-Bains" },
    { nom: "Hautes-Alpes", numero: "05", prefecture: "Gap" },
    { nom: "Alpes-Maritimes", numero: "06", prefecture: "Nice" },
    { nom: "Ard√®che", numero: "07", prefecture: "Privas" },
    { nom: "Ardennes", numero: "08", prefecture: "Charleville-M√©zi√®res" },
    { nom: "Ari√®ge", numero: "09", prefecture: "Foix" },
    { nom: "Aube", numero: "10", prefecture: "Troyes" },
    { nom: "Aude", numero: "11", prefecture: "Carcassonne" },
    { nom: "Aveyron", numero: "12", prefecture: "Rodez" },
    { nom: "Bouches-du-Rh√¥ne", numero: "13", prefecture: "Marseille" },
    { nom: "Calvados", numero: "14", prefecture: "Caen" },
    { nom: "Cantal", numero: "15", prefecture: "Aurillac" },
    { nom: "Charente", numero: "16", prefecture: "Angoul√™me" },
    { nom: "Charente-Maritime", numero: "17", prefecture: "La Rochelle" },
    { nom: "Cher", numero: "18", prefecture: "Bourges" },
    { nom: "Corr√®ze", numero: "19", prefecture: "Tulle" },
    { nom: "Corse-du-Sud", numero: "2A", prefecture: "Ajaccio" },
    { nom: "Haute-Corse", numero: "2B", prefecture: "Bastia" },
    { nom: "C√¥te-d'Or", numero: "21", prefecture: "Dijon" },
    { nom: "C√¥tes-d'Armor", numero: "22", prefecture: "Saint-Brieuc" },
    { nom: "Creuse", numero: "23", prefecture: "Gu√©ret" },
    { nom: "Dordogne", numero: "24", prefecture: "P√©rigueux" },
    { nom: "Doubs", numero: "25", prefecture: "Besan√ßon" },
    { nom: "Dr√¥me", numero: "26", prefecture: "Valence" },
    { nom: "Eure", numero: "27", prefecture: "√âvreux" },
    { nom: "Eure-et-Loir", numero: "28", prefecture: "Chartres" },
    { nom: "Finist√®re", numero: "29", prefecture: "Quimper" },
    { nom: "Gard", numero: "30", prefecture: "N√Æmes" },
    { nom: "Haute-Garonne", numero: "31", prefecture: "Toulouse" },
    { nom: "Gers", numero: "32", prefecture: "Auch" },
    { nom: "Gironde", numero: "33", prefecture: "Bordeaux" },
    { nom: "H√©rault", numero: "34", prefecture: "Montpellier" },
    { nom: "Ille-et-Vilaine", numero: "35", prefecture: "Rennes" },
    { nom: "Indre", numero: "36", prefecture: "Ch√¢teauroux" },
    { nom: "Indre-et-Loire", numero: "37", prefecture: "Tours" },
    { nom: "Is√®re", numero: "38", prefecture: "Grenoble" },
    { nom: "Jura", numero: "39", prefecture: "Lons-le-Saunier" },
    { nom: "Landes", numero: "40", prefecture: "Mont-de-Marsan" },
    { nom: "Loir-et-Cher", numero: "41", prefecture: "Blois" },
    { nom: "Loire", numero: "42", prefecture: "Saint-√âtienne" },
    { nom: "Haute-Loire", numero: "43", prefecture: "Le Puy-en-Velay" },
    { nom: "Loire-Atlantique", numero: "44", prefecture: "Nantes" },
    { nom: "Loiret", numero: "45", prefecture: "Orl√©ans" },
    { nom: "Lot", numero: "46", prefecture: "Cahors" },
    { nom: "Lot-et-Garonne", numero: "47", prefecture: "Agen" },
    { nom: "Loz√®re", numero: "48", prefecture: "Mende" },
    { nom: "Maine-et-Loire", numero: "49", prefecture: "Angers" },
    { nom: "Manche", numero: "50", prefecture: "Saint-L√¥" },
    { nom: "Marne", numero: "51", prefecture: "Ch√¢lons-en-Champagne" },
    { nom: "Haute-Marne", numero: "52", prefecture: "Chaumont" },
    { nom: "Mayenne", numero: "53", prefecture: "Laval" },
    { nom: "Meurthe-et-Moselle", numero: "54", prefecture: "Nancy" },
    { nom: "Meuse", numero: "55", prefecture: "Bar-le-Duc" },
    { nom: "Morbihan", numero: "56", prefecture: "Vannes" },
    { nom: "Moselle", numero: "57", prefecture: "Metz" },
    { nom: "Ni√®vre", numero: "58", prefecture: "Nevers" },
    { nom: "Nord", numero: "59", prefecture: "Lille" },
    { nom: "Oise", numero: "60", prefecture: "Beauvais" },
    { nom: "Orne", numero: "61", prefecture: "Alen√ßon" },
    { nom: "Pas-de-Calais", numero: "62", prefecture: "Arras" },
    { nom: "Puy-de-D√¥me", numero: "63", prefecture: "Clermont-Ferrand" },
    { nom: "Pyr√©n√©es-Atlantiques", numero: "64", prefecture: "Pau" },
    { nom: "Hautes-Pyr√©n√©es", numero: "65", prefecture: "Tarbes" },
    { nom: "Pyr√©n√©es-Orientales", numero: "66", prefecture: "Perpignan" },
    { nom: "Bas-Rhin", numero: "67", prefecture: "Strasbourg" },
    { nom: "Haut-Rhin", numero: "68", prefecture: "Colmar" },
    { nom: "Rh√¥ne", numero: "69", prefecture: "Lyon" },
    { nom: "Haute-Sa√¥ne", numero: "70", prefecture: "Vesoul" },
    { nom: "Sa√¥ne-et-Loire", numero: "71", prefecture: "M√¢con" },
    { nom: "Sarthe", numero: "72", prefecture: "Le Mans" },
    { nom: "Savoie", numero: "73", prefecture: "Chamb√©ry" },
    { nom: "Haute-Savoie", numero: "74", prefecture: "Annecy" },
    { nom: "Paris", numero: "75", prefecture: "Paris" },
    { nom: "Seine-Maritime", numero: "76", prefecture: "Rouen" },
    { nom: "Seine-et-Marne", numero: "77", prefecture: "Melun" },
    { nom: "Yvelines", numero: "78", prefecture: "Versailles" },
    { nom: "Deux-S√®vres", numero: "79", prefecture: "Niort" },
    { nom: "Somme", numero: "80", prefecture: "Amiens" },
    { nom: "Tarn", numero: "81", prefecture: "Albi" },
    { nom: "Tarn-et-Garonne", numero: "82", prefecture: "Montauban" },
    { nom: "Var", numero: "83", prefecture: "Toulon" },
    { nom: "Vaucluse", numero: "84", prefecture: "Avignon" },
    { nom: "Vend√©e", numero: "85", prefecture: "La Roche-sur-Yon" },
    { nom: "Vienne", numero: "86", prefecture: "Poitiers" },
    { nom: "Haute-Vienne", numero: "87", prefecture: "Limoges" },
    { nom: "Vosges", numero: "88", prefecture: "√âpinal" },
    { nom: "Yonne", numero: "89", prefecture: "Auxerre" },
    { nom: "Territoire de Belfort", numero: "90", prefecture: "Belfort" },
    { nom: "Essonne", numero: "91", prefecture: "√âvry-Courcouronnes" },
    { nom: "Hauts-de-Seine", numero: "92", prefecture: "Nanterre" },
    { nom: "Seine-Saint-Denis", numero: "93", prefecture: "Bobigny" },
    { nom: "Val-de-Marne", numero: "94", prefecture: "Cr√©teil" },
    { nom: "Val-d'Oise", numero: "95", prefecture: "Cergy" },
    { nom: "Guadeloupe", numero: "971", prefecture: "Basse-Terre" },
    { nom: "Martinique", numero: "972", prefecture: "Fort-de-France" },
    { nom: "Guyane", numero: "973", prefecture: "Cayenne" },
    { nom: "La R√©union", numero: "974", prefecture: "Saint-Denis" },
    { nom: "Mayotte", numero: "976", prefecture: "Mamoudzou" }
];

const modes = {
    1: { time: 30, qTime: 4, lives: 5, questionType: "nom_to_num" },
    2: { time: 20, qTime: 3, lives: 5, questionType: "num_to_nom" },
    3: { time: 30, qTime: 3, lives: 5, questionType: "shape_to_nom_num" },
    4: { time: 40, qTime: 4, lives: 5, questionType: "prefecture_to_nom" },
    5: { time: 40, qTime: 4, lives: 5, questionType: "mix_nom_num_prefecture" },
    6: { time: 50, qTime: 4, lives: 5, questionType: "mix_all" }
};
const requiredModeUnlock = { 2: 10, 3: 10, 4: 10, 5: 10, 6: 15 };
let bestScore = [0,0,0,0,0,0];

let currentMode = 0, score = 0, lives = 0, timeLeft = 0, qTime = 0;
let timerInterval = null, qTimerInterval = null, awaitingNext = false;
let previousQuestions = [];
let correctAnswer;

const homeSection = document.getElementById('home-section');
const quizSection = document.getElementById('quiz-section');
const resultSection = document.getElementById('result-section');
const modeButtons = document.querySelectorAll('.dropdown-item');
const restartBtn = document.getElementById('restart-btn');
const homeBtn = document.getElementById('home-btn');
const answerBtns = document.querySelectorAll('.answer-btn');
const questionBox = document.getElementById('question');
const scoreDisplay = document.getElementById('score');
const livesDisplay = document.getElementById('lives');
const timerDisplay = document.getElementById('timer');
const qTimerDisplay = document.getElementById('question-timer');
const timerFill = document.getElementById('timer-fill');
const qTimerFill = document.getElementById('question-timer-fill');
const finalScore = document.getElementById('final-score');
const dropdown = document.querySelector('.dropdown');
const dropdownBtn = document.querySelector('.dropdown-btn');

dropdownBtn.addEventListener('click', () => dropdown.classList.toggle('open'));
document.addEventListener('click', (e) => {
    if (!dropdown.contains(e.target)) dropdown.classList.remove('open');
});

document.addEventListener("DOMContentLoaded", () => {
    homeSection.classList.remove('hidden');
    quizSection.classList.add('hidden');
    resultSection.classList.add('hidden');
    updateModeButtons();
});

modeButtons.forEach(btn => {
    btn.addEventListener('click', e => {
        const selected = parseInt(btn.dataset.mode);
        if (!selected) return;

        if (selected > 1 && bestScore[selected - 2] < requiredModeUnlock[selected]) {
            showHoverWarning(
                `Vous devez faire au moins ${requiredModeUnlock[selected]} au mode ${selected - 1} pour d√©bloquer ce mode`,
                e.pageX,
                e.pageY
            );
            e.preventDefault();
            e.stopPropagation();
            return;
        }

        currentMode = selected;
        dropdown.classList.remove('open');
        startMode();
    });
});

function showHoverWarning(text, x, y) {
    const warn = document.getElementById("hover-warning");
    warn.textContent = text;
    warn.style.left = (x + 12) + "px";
    warn.style.top = (y + 12) + "px";
    warn.style.opacity = 1;
    setTimeout(() => { warn.style.opacity = 0; }, 1800);
}

function startMode() {
    if (!modes[currentMode]) return;
    stopAllTimers();
    const mode = modes[currentMode];
    score = 0;
    lives = mode.lives;
    timeLeft = mode.time;
    qTime = mode.qTime;
    awaitingNext = false;
    previousQuestions = [];
    updateLives();
    scoreDisplay.textContent = score;
    homeSection.classList.add('hidden');
    resultSection.classList.add('hidden');
    quizSection.classList.remove('hidden');
    generateQuestion();
    startMainTimer();
}

function generateQuestion() {
    if (awaitingNext) return;
    let dep;
    do { dep = departements[Math.floor(Math.random() * departements.length)]; }
    while (previousQuestions.includes(dep.numero) && previousQuestions.length < departements.length);
    previousQuestions.push(dep.numero);
    if (previousQuestions.length > 20) previousQuestions.shift();

    qTime = modes[currentMode].qTime;
    qTimerDisplay.textContent = qTime;
    qTimerFill.style.width = '100%';

    let questionText;
    switch (modes[currentMode].questionType) {
        case "nom_to_num":
            questionText = `Quel est le num√©ro du d√©partement ?<br><span style="font-size:1.4em;">${dep.nom}</span>`;
            correctAnswer = dep.numero;
            break;
        case "num_to_nom":
            questionText = `Quel est le nom du d√©partement ?<br><span style="font-size:1.4em;">${dep.numero}</span>`;
            correctAnswer = dep.nom;
            break;
        case "shape_to_nom_num":
            questionText = `<img src="images/${dep.numero}.png" alt="${dep.nom}" style="width:100%;max-height:200px;">`;
            correctAnswer = Math.random() > 0.5 ? dep.nom : dep.numero;
            break;
        case "prefecture_to_nom":
            questionText = `Dans quel d√©partement se trouve cette pr√©fecture ?<br><span style="font-size:1.4em;">${dep.prefecture}</span>`;
            correctAnswer = dep.nom;
            break;
        case "mix_nom_num_prefecture":
            const randType = Math.random();
            if (randType < 0.33) {
                questionText = `Quel est le num√©ro du d√©partement ?<br><span style="font-size:1.4em;">${dep.nom}</span>`;
                correctAnswer = dep.numero;
            } else if (randType < 0.66) {
                questionText = `Quel est le nom du d√©partement ?<br><span style="font-size:1.4em;">${dep.numero}</span>`;
                correctAnswer = dep.nom;
            } else {
                questionText = `Dans quel d√©partement se trouve cette pr√©fecture ?<br><span style="font-size:1.4em;">${dep.prefecture}</span>`;
                correctAnswer = dep.nom;
            }
            break;
        case "mix_all":
            const allTypes = Math.random();
            if (allTypes < 0.25) {
                questionText = `Quel est le num√©ro du d√©partement ?<br><span style="font-size:1.4em;">${dep.nom}</span>`;
                correctAnswer = dep.numero;
            } else if (allTypes < 0.5) {
                questionText = `Quel est le nom du d√©partement ?<br><span style="font-size:1.4em;">${dep.numero}</span>`;
                correctAnswer = dep.nom;
            } else if (allTypes < 0.75) {
                questionText = `Dans quel d√©partement se trouve cette pr√©fecture ?<br><span style="font-size:1.4em;">${dep.prefecture}</span>`;
                correctAnswer = dep.nom;
            } else {
                questionText = `<img src="images/${dep.numero}.png" alt="${dep.nom}" style="width:100%;max-height:200px;">`;
                correctAnswer = Math.random() > 0.5 ? dep.nom : dep.numero;
            }
            break;
    }
    questionBox.innerHTML = questionText;

    let wrongAnswers = [];
    const otherDeps = departements.filter(d => d !== dep).sort(() => Math.random() - 0.5);
    
    if (modes[currentMode].questionType === "nom_to_num" || (correctAnswer === dep.numero)) {
        wrongAnswers = otherDeps.slice(0, 4).map(d => d.numero);
    } else if (modes[currentMode].questionType === "num_to_nom" || modes[currentMode].questionType === "prefecture_to_nom" || correctAnswer === dep.nom) {
        wrongAnswers = otherDeps.slice(0, 4).map(d => d.nom);
    } else {
        wrongAnswers = otherDeps.slice(0, 4).map(d => Math.random() > 0.5 ? d.nom : d.numero);
    }

    let options = [...wrongAnswers, correctAnswer].sort(() => Math.random() - 0.5);
    answerBtns.forEach((btn, i) => {
        btn.textContent = options[i];
        btn.disabled = false;
        btn.classList.remove("correct", "incorrect");
        btn.onclick = () => handleAnswer(options[i]);
    });
    startQTimer();
}

function handleAnswer(selected) {
    if(awaitingNext) return;
    awaitingNext = true;
    clearInterval(qTimerInterval);
    answerBtns.forEach(btn => {
        btn.disabled = true;
        if(btn.textContent === correctAnswer) btn.classList.add("correct");
        if(btn.textContent === selected && selected !== correctAnswer) btn.classList.add("incorrect");
    });
    if(selected === correctAnswer) score++;
    else lives--;
    updateLives();
    scoreDisplay.textContent = score;
    setTimeout(() => {
        awaitingNext = false;
        if(lives <= 0) endGame();
        else generateQuestion();
    }, 800);
}

function updateLives() {
    livesDisplay.textContent = '‚ù§'.repeat(lives) + '‚ô°'.repeat(modes[currentMode].lives - lives);
}

function startMainTimer() {
    timerDisplay.textContent = timeLeft;
    timerFill.style.width = '100%';
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = timeLeft;
        timerFill.style.width = (timeLeft / modes[currentMode].time * 100) + '%';
        if(timeLeft <= 5) timerFill.style.background='#dc3545';
        else if(timeLeft <= 10) timerFill.style.background='#ffa500';
        else timerFill.style.background='#9c28a7ff';
        if(timeLeft <= 0){ clearInterval(timerInterval); endGame(); }
    },1000);
}

function startQTimer() {
    clearInterval(qTimerInterval);
    qTimerInterval = setInterval(() => {
        qTime -= 0.1;
        qTimerDisplay.textContent = Math.ceil(qTime);
        qTimerFill.style.width = (qTime / modes[currentMode].qTime * 100) + '%';
        if(qTime<=0){ clearInterval(qTimerInterval); lives--; updateLives(); handleAnswer(''); }
    }, 100);
}

function endGame() {
    quizSection.classList.add('hidden');
    resultSection.classList.remove('hidden');
    if(score > bestScore[currentMode-1]) bestScore[currentMode-1] = score;
    finalScore.textContent = score;
    stopAllTimers();
    updateModeButtons();
}

function stopAllTimers() {
    clearInterval(timerInterval);
    clearInterval(qTimerInterval);
}

restartBtn.onclick = startMode;
homeBtn.onclick = () => {
    stopAllTimers();
    quizSection.classList.add('hidden');
    resultSection.classList.add('hidden');
    homeSection.classList.remove('hidden');
};

function updateModeButtons() {
    modeButtons.forEach(btn => {
        const modeNum = parseInt(btn.dataset.mode);
        if (modeNum > 1 && bestScore[modeNum - 2] < requiredModeUnlock[modeNum]) {
            btn.classList.add('disabled');
            btn.disabled = false;
        } else {
            btn.classList.remove('disabled');
            btn.disabled = false;
        }
    });
}
</script>

</body>
</html>